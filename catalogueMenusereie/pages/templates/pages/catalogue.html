{% extends "pages/base.html" %}
{% load static %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block title %}{{ page.title }}{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/catalogue.css' %}">
{% endblock %}

{% block content %}
<div class="container catalogue">
  <h1>{{ page.title }}</h1>
  <div class="description">{{ page.description|richtext }}</div>

  <!-- Barre de recherche / filtres -->
  <form method="get" class="catalogue-filter">
    <label for="q">Rechercher par titre</label>
    <input id="q" type="text" name="q" placeholder="Rechercher par titre…" value="{{ q }}">
    <label for="min">Prix min</label>
    <input id="min" type="number" step="0.01" name="min" placeholder="Prix min" value="{{ min }}">
    <label for="max">Prix max</label>
    <input id="max" type="number" step="0.01" name="max" placeholder="Prix max" value="{{ max }}">
    <button type="submit" class="button">Filtrer</button>
    {% if q or min or max %}
      <a href="{{ page.url }}" class="button ghost">Réinitialiser</a>
    {% endif %}
  </form>

  <div class="grid">
    {% for item in items %}
      {% with bloc=item.value %}
      <div class="card">
        {% if bloc.image %}
          <div class="card-image">
            {% image bloc.image fill-600x375 alt=bloc.titre %}
          </div>
        {% endif %}
        <div class="card-body">
          <h3>{{ bloc.titre }}</h3>
          {% if bloc.details %}<div class="details">{{ bloc.details|richtext }}</div>{% endif %}
          {% if bloc.prix %}<p class="price">{{ bloc.prix }} Cfa</p>{% endif %}
          <a href="/devis/?title={{ bloc.titre|urlencode }}&page={{ page.url|urlencode }}{% if bloc.image %}&image={{ bloc.image.id }}{% endif %}" class="button">Demander un devis</a>
        </div>
      </div>
      {% endwith %}
    {% empty %}
      <p class="muted">Aucun élément ne correspond à votre recherche.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
